import { readFile } from "node:fs/promises";
import { join } from "node:path";

import { ImageResponse } from "next/og";

export async function GET(request: Request) {
  const { searchParams } = new URL(request.url);

  const title = searchParams.get("title");

  const robotoCondensedMedium = await readFile(
    join(process.cwd(), "src/assets/fonts/RobotoCondensed-Medium.ttf")
  );

  return new ImageResponse(
    (
      <div tw="w-full h-full flex items-center justify-center text-white bg-black p-16">
        <div tw="absolute flex inset-y-0 w-px border border-zinc-800 left-16" />
        <div tw="absolute flex inset-y-0 w-px border border-zinc-800 right-16" />
        <div tw="absolute flex inset-x-0 h-px border border-zinc-800 top-16" />
        <div tw="absolute flex inset-x-0 h-px border border-zinc-800 bottom-16" />

        <div tw="absolute flex bottom-16 right-16">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 127 20"
          >
            <path
              d="M60.236 15V13.11L60.056 12.696V9.312C60.056 8.712 59.87 8.244 59.498 7.908C59.138 7.572 58.58 7.404 57.824 7.404C57.308 7.404 56.798 7.488 56.294 7.656C55.802 7.812 55.382 8.028 55.034 8.304L54.026 6.342C54.554 5.97 55.19 5.682 55.934 5.478C56.678 5.274 57.434 5.172 58.202 5.172C59.678 5.172 60.824 5.52 61.64 6.216C62.456 6.912 62.864 7.998 62.864 9.474V15H60.236ZM57.284 15.144C56.528 15.144 55.88 15.018 55.34 14.766C54.8 14.502 54.386 14.148 54.098 13.704C53.81 13.26 53.666 12.762 53.666 12.21C53.666 11.634 53.804 11.13 54.08 10.698C54.368 10.266 54.818 9.93 55.43 9.69C56.042 9.438 56.84 9.312 57.824 9.312H60.398V10.95H58.13C57.47 10.95 57.014 11.058 56.762 11.274C56.522 11.49 56.402 11.76 56.402 12.084C56.402 12.444 56.54 12.732 56.816 12.948C57.104 13.152 57.494 13.254 57.986 13.254C58.454 13.254 58.874 13.146 59.246 12.93C59.618 12.702 59.888 12.372 60.056 11.94L60.488 13.236C60.284 13.86 59.912 14.334 59.372 14.658C58.832 14.982 58.136 15.144 57.284 15.144ZM69.4914 15.144C68.6874 15.144 67.9674 14.988 67.3314 14.676C66.7074 14.364 66.2214 13.89 65.8734 13.254C65.5254 12.606 65.3514 11.784 65.3514 10.788V5.316H68.1594V10.374C68.1594 11.178 68.3274 11.772 68.6634 12.156C69.0114 12.528 69.4974 12.714 70.1214 12.714C70.5534 12.714 70.9374 12.624 71.2734 12.444C71.6094 12.252 71.8734 11.964 72.0654 11.58C72.2574 11.184 72.3534 10.692 72.3534 10.104V5.316H75.1614V15H72.4974V12.336L72.9834 13.11C72.6594 13.782 72.1794 14.292 71.5434 14.64C70.9194 14.976 70.2354 15.144 69.4914 15.144ZM82.3168 18.636C81.4048 18.636 80.5228 18.522 79.6708 18.294C78.8308 18.078 78.1288 17.748 77.5648 17.304L78.6808 15.288C79.0888 15.624 79.6048 15.888 80.2288 16.08C80.8648 16.284 81.4888 16.386 82.1008 16.386C83.0968 16.386 83.8168 16.164 84.2608 15.72C84.7168 15.276 84.9448 14.616 84.9448 13.74V12.282L85.1248 9.852L85.0888 7.404V5.316H87.7528V13.38C87.7528 15.18 87.2848 16.506 86.3488 17.358C85.4128 18.21 84.0688 18.636 82.3168 18.636ZM81.8848 14.532C80.9848 14.532 80.1688 14.34 79.4368 13.956C78.7168 13.56 78.1348 13.014 77.6908 12.318C77.2588 11.61 77.0428 10.788 77.0428 9.852C77.0428 8.904 77.2588 8.082 77.6908 7.386C78.1348 6.678 78.7168 6.132 79.4368 5.748C80.1688 5.364 80.9848 5.172 81.8848 5.172C82.7008 5.172 83.4208 5.34 84.0448 5.676C84.6688 6 85.1548 6.51 85.5028 7.206C85.8508 7.89 86.0248 8.772 86.0248 9.852C86.0248 10.92 85.8508 11.802 85.5028 12.498C85.1548 13.182 84.6688 13.692 84.0448 14.028C83.4208 14.364 82.7008 14.532 81.8848 14.532ZM82.4428 12.228C82.9348 12.228 83.3728 12.132 83.7568 11.94C84.1408 11.736 84.4408 11.454 84.6568 11.094C84.8728 10.734 84.9808 10.32 84.9808 9.852C84.9808 9.372 84.8728 8.958 84.6568 8.61C84.4408 8.25 84.1408 7.974 83.7568 7.782C83.3728 7.578 82.9348 7.476 82.4428 7.476C81.9508 7.476 81.5128 7.578 81.1288 7.782C80.7448 7.974 80.4388 8.25 80.2108 8.61C79.9948 8.958 79.8868 9.372 79.8868 9.852C79.8868 10.32 79.9948 10.734 80.2108 11.094C80.4388 11.454 80.7448 11.736 81.1288 11.94C81.5128 12.132 81.9508 12.228 82.4428 12.228ZM94.4523 15.144C93.6483 15.144 92.9283 14.988 92.2923 14.676C91.6683 14.364 91.1823 13.89 90.8343 13.254C90.4863 12.606 90.3123 11.784 90.3123 10.788V5.316H93.1203V10.374C93.1203 11.178 93.2883 11.772 93.6243 12.156C93.9723 12.528 94.4583 12.714 95.0823 12.714C95.5143 12.714 95.8983 12.624 96.2343 12.444C96.5703 12.252 96.8343 11.964 97.0263 11.58C97.2183 11.184 97.3143 10.692 97.3143 10.104V5.316H100.122V15H97.4583V12.336L97.9443 13.11C97.6203 13.782 97.1403 14.292 96.5043 14.64C95.8803 14.976 95.1963 15.144 94.4523 15.144ZM105.982 15.144C105.154 15.144 104.356 15.048 103.588 14.856C102.832 14.652 102.232 14.4 101.788 14.1L102.724 12.084C103.168 12.36 103.69 12.588 104.29 12.768C104.902 12.936 105.502 13.02 106.09 13.02C106.738 13.02 107.194 12.942 107.458 12.786C107.734 12.63 107.872 12.414 107.872 12.138C107.872 11.91 107.764 11.742 107.548 11.634C107.344 11.514 107.068 11.424 106.72 11.364C106.372 11.304 105.988 11.244 105.568 11.184C105.16 11.124 104.746 11.046 104.326 10.95C103.906 10.842 103.522 10.686 103.174 10.482C102.826 10.278 102.544 10.002 102.328 9.654C102.124 9.306 102.022 8.856 102.022 8.304C102.022 7.692 102.196 7.152 102.544 6.684C102.904 6.216 103.42 5.85 104.092 5.586C104.764 5.31 105.568 5.172 106.504 5.172C107.164 5.172 107.836 5.244 108.52 5.388C109.204 5.532 109.774 5.742 110.23 6.018L109.294 8.016C108.826 7.74 108.352 7.554 107.872 7.458C107.404 7.35 106.948 7.296 106.504 7.296C105.88 7.296 105.424 7.38 105.136 7.548C104.848 7.716 104.704 7.932 104.704 8.196C104.704 8.436 104.806 8.616 105.01 8.736C105.226 8.856 105.508 8.952 105.856 9.024C106.204 9.096 106.582 9.162 106.99 9.222C107.41 9.27 107.83 9.348 108.25 9.456C108.67 9.564 109.048 9.72 109.384 9.924C109.732 10.116 110.014 10.386 110.23 10.734C110.446 11.07 110.554 11.514 110.554 12.066C110.554 12.666 110.374 13.2 110.014 13.668C109.654 14.124 109.132 14.484 108.448 14.748C107.776 15.012 106.954 15.144 105.982 15.144ZM116.246 15.144C115.106 15.144 114.218 14.856 113.582 14.28C112.946 13.692 112.628 12.822 112.628 11.67V3.174H115.436V11.634C115.436 12.042 115.544 12.36 115.76 12.588C115.976 12.804 116.27 12.912 116.642 12.912C117.086 12.912 117.464 12.792 117.776 12.552L118.532 14.532C118.244 14.736 117.896 14.892 117.488 15C117.092 15.096 116.678 15.144 116.246 15.144ZM111.134 7.692V5.532H117.848V7.692H111.134ZM123.858 15.144C122.718 15.144 121.83 14.856 121.194 14.28C120.558 13.692 120.24 12.822 120.24 11.67V3.174H123.048V11.634C123.048 12.042 123.156 12.36 123.372 12.588C123.588 12.804 123.882 12.912 124.254 12.912C124.698 12.912 125.076 12.792 125.388 12.552L126.144 14.532C125.856 14.736 125.508 14.892 125.1 15C124.704 15.096 124.29 15.144 123.858 15.144ZM118.746 7.692V5.532H125.46V7.692H118.746Z"
              fill="currentColor"
            />
            <g clipPath="url(#clip0_0_1)">
              <rect x="4" width="4" height="4" fill="currentColor" />
              <rect x="8" width="4" height="4" fill="currentColor" />
              <rect x="12" width="4" height="4" fill="currentColor" />
              <rect y="4" width="4" height="4" fill="currentColor" />
              <rect y="8" width="4" height="4" fill="currentColor" />
              <rect x="8" y="8" width="4" height="4" fill="currentColor" />
              <rect x="12" y="8" width="4" height="4" fill="currentColor" />
              <rect x="4" y="8" width="4" height="4" fill="currentColor" />
              <rect y="16" width="4" height="4" fill="currentColor" />
              <rect y="12" width="4" height="4" fill="currentColor" />
              <rect x="28" width="4" height="4" fill="currentColor" />
              <rect x="24" y="4" width="4" height="4" fill="currentColor" />
              <rect x="24" y="12" width="4" height="4" fill="currentColor" />
              <rect x="28" y="16" width="4" height="4" fill="currentColor" />
              <rect x="40" y="12" width="4" height="4" fill="currentColor" />
              <rect x="36" y="16" width="4" height="4" fill="currentColor" />
              <rect x="32" y="16" width="4" height="4" fill="currentColor" />
              <rect x="24" y="8" width="4" height="4" fill="currentColor" />
              <rect x="36" width="4" height="4" fill="currentColor" />
              <rect x="40" y="8" width="4" height="4" fill="currentColor" />
              <rect x="36" y="8" width="4" height="4" fill="currentColor" />
              <rect x="32" y="8" width="4" height="4" fill="currentColor" />
              <rect x="32" width="4" height="4" fill="currentColor" />
              <rect x="16" y="16" width="4" height="4" fill="currentColor" />
              <rect x="16" y="12" width="4" height="4" fill="currentColor" />
              <rect x="16" y="8" width="4" height="4" fill="currentColor" />
              <rect x="16" y="4" width="4" height="4" fill="currentColor" />
            </g>
          </svg>
        </div>

        <h1
          tw="text-center font-medium"
          style={{
            fontFamily: "RobotoCondensed",
            fontSize: 64,
          }}
        >
          {title}
        </h1>
      </div>
    ),
    {
      width: 1200,
      height: 630,
      fonts: [
        {
          name: "RobotoCondensed",
          data: robotoCondensedMedium,
          weight: 500,
        },
      ],
    }
  );
}
